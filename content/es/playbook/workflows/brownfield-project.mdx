# Proyecto Brownfield

Unirse o mejorar una base de código existente con AIOS. Esta guía cubre el proceso de evaluación Brownfield Discovery y las tres variantes de flujo de trabajo de implementación para proyectos existentes.

## Cuándo Usar un Flujo de Trabajo Brownfield

Usa un flujo de trabajo brownfield cuando estés trabajando con una base de código existente. Escenarios típicos incluyen:

- Migrar proyectos desde Lovable, v0.dev u otro código generado por IA
- Auditar y modernizar una base de código legada
- Agregar funcionalidades significativas a una aplicación existente
- Due diligence técnica pre-inversión
- Incorporarse a un proyecto construido por otro equipo

## Brownfield Discovery: Evaluación de 10 Fases

Antes de hacer cambios a un proyecto existente, ejecuta el flujo de trabajo Brownfield Discovery para producir una evaluación integral de deuda técnica. Este es el primer paso recomendado para cualquier compromiso brownfield.

```
*workflow brownfield-discovery
```

**Duración estimada:** 4-8 horas dependiendo de la complejidad del proyecto.

### Recolección de Datos (Fases 1-3)

| Fase | Agente | Produce | Notas |
|------|--------|---------|-------|
| 1. Arquitectura del Sistema | @architect (Aria) | `docs/architecture/system-architecture.md` | Analiza stack, dependencias, patrones de código, integraciones |
| 2. Auditoría de Base de Datos | @data-engineer (Dara) | `supabase/docs/SCHEMA.md`, `DB-AUDIT.md` | Se omite si el proyecto no tiene base de datos |
| 3. Spec de Frontend/UX | @ux-expert (Uma) | `docs/frontend/frontend-spec.md` | Componentes, sistema de diseño, accesibilidad, responsividad |

### Borrador y Validación (Fases 4-7)

| Fase | Agente | Produce | Notas |
|------|--------|---------|-------|
| 4. Consolidación Inicial | @architect (Aria) | `docs/prd/technical-debt-DRAFT.md` | Fusiona todos los hallazgos en un único BORRADOR |
| 5. Revisión de Especialista DB | @data-engineer (Dara) | `docs/reviews/db-specialist-review.md` | Valida, estima y prioriza deudas de DB |
| 6. Revisión de Especialista UX | @ux-expert (Uma) | `docs/reviews/ux-specialist-review.md` | Valida, estima y prioriza deudas de UX |
| 7. QA Gate | @qa (Quinn) | `docs/reviews/qa-review.md` | Gate de calidad: APPROVED o NEEDS WORK |

Si el QA gate devuelve **NEEDS WORK**, el proceso retorna a la Fase 4 para retrabajo. El arquitecto incorpora el feedback de QA y el borrador pasa por las revisiones de especialistas nuevamente.

### Finalización (Fases 8-10)

| Fase | Agente | Produce | Notas |
|------|--------|---------|-------|
| 8. Evaluación Final | @architect (Aria) | `docs/prd/technical-debt-assessment.md` | Incorpora todas las revisiones de especialistas |
| 9. Reporte Ejecutivo | @analyst (Atlas) | `docs/reports/TECHNICAL-DEBT-REPORT.md` | Análisis de costos, ROI, cronograma para stakeholders |
| 10. Planificación | @pm (Morgan) | Épica + historias | Crea historias de desarrollo accionables |

### Estructura de Salida del Discovery

Después de que el flujo de trabajo de discovery se completa, tu directorio `docs/` contendrá:

```
docs/
  architecture/
    system-architecture.md        # Fase 1
  frontend/
    frontend-spec.md              # Fase 3
  reviews/
    db-specialist-review.md       # Fase 5
    ux-specialist-review.md       # Fase 6
    qa-review.md                  # Fase 7
  prd/
    technical-debt-DRAFT.md       # Fase 4
    technical-debt-assessment.md  # Fase 8
  reports/
    TECHNICAL-DEBT-REPORT.md      # Fase 9
  stories/
    epic-technical-debt.md        # Fase 10
    story-1.1-*.md
```

## Variantes de Implementación

Después del discovery (o para mejoras que no requieren un discovery completo), AIOS proporciona tres flujos de trabajo de implementación brownfield:

| Variante | Comando | Ideal Para |
|----------|---------|------------|
| **Full-Stack** | `*workflow brownfield-fullstack` | Mejoras que tocan tanto frontend como backend |
| **Servicio/API** | `*workflow brownfield-service` | Modernización de servicios backend, mejoras de API |
| **Solo UI** | `*workflow brownfield-ui` | Modernización de frontend, rediseño, mejoras de UI |

### Clasificación de Mejoras

Los flujos de trabajo brownfield full-stack y servicio comienzan con un paso de clasificación de mejoras por @analyst:

| Tamaño | Historias | Ruta |
|--------|-----------|------|
| Historia Única | 1 (menos de 4 horas) | `@pm *brownfield-create-story` -- sale del flujo de trabajo |
| Funcionalidad Pequeña | 1-3 historias | `@pm *brownfield-create-epic` -- sale del flujo de trabajo |
| Mejora Mayor | Múltiples épicas | Continúa a través del flujo de trabajo de planificación completo |

Para mejoras mayores, el flujo de trabajo verifica la adecuación de la documentación existente. Si la documentación está desactualizada o falta, `@architect *document-project` se ejecuta primero.

### Fases de Implementación

Todas las variantes de implementación brownfield comparten estas fases:

1. **Planificación** -- @architect analiza el sistema existente; @pm crea un PRD brownfield; @architect crea arquitectura (si se necesitan cambios arquitectónicos)
2. **Validación** -- @po valida todos los artefactos con el po-master-checklist; los problemas son corregidos por el agente correspondiente
3. **Ciclo de Desarrollo** -- @po fragmenta documentos; @sm crea historias; @dev implementa; @qa revisa
4. **Finalización** -- Retrospectiva de épica opcional por @po

### Consideraciones Específicas de Brownfield

A diferencia de los flujos de trabajo greenfield, los flujos brownfield incluyen salvaguardas adicionales:

- **Validación de seguridad de integración** -- @po verifica que los cambios no rompan funcionalidad existente
- **Evaluación de riesgo de regresión** -- @qa evalúa el riesgo de regresiones
- **Feature flags** -- Considerar despliegue gradual para cambios mayores
- **Patrones existentes** -- Las decisiones de arquitectura respetan los patrones de código existentes cuando es posible

## Comandos de Inicio Rápido

```
# Evaluación completa de deuda técnica (primer paso recomendado)
*workflow brownfield-discovery

# Mejora full-stack
*workflow brownfield-fullstack

# Mejora de servicio backend
*workflow brownfield-service

# Mejora de frontend/UI
*workflow brownfield-ui

# Rápido: crear una única historia brownfield
@pm *brownfield-create-story

# Rápido: crear una épica brownfield pequeña (1-3 historias)
@pm *brownfield-create-epic
```

## Priorización Después del Discovery

Después de completar el Brownfield Discovery, trabaja con @po para priorizar historias basándote en:

- **Impacto de negocio** -- Qué deudas afectan más a los usuarios
- **Riesgo técnico** -- Vulnerabilidades de seguridad y problemas de integridad de datos primero
- **Dependencias** -- Resolver deudas bloqueantes antes de las dependientes
- **Quick wins** -- Ítems de bajo esfuerzo y alto impacto para ganar momentum temprano

## Resolución de Problemas

| Problema | Solución |
|----------|----------|
| Auditoría de base de datos falla | Verificar la variable de entorno `SUPABASE_DB_URL` y el acceso a la red |
| Evaluación muy grande (50+ deudas) | Priorizar por severidad; agrupar deudas similares; considerar múltiples épicas |
| QA gate se repite (NEEDS WORK repetido) | Enfocarse en las brechas específicas identificadas por @qa; considerar aprobar con condiciones documentadas |
| Especialistas no están de acuerdo en prioridades | @architect media; usar frameworks de priorización objetivos (RICE, ICE) |
| Mejora mal clasificada | Re-ejecutar clasificación con @analyst proporcionando más contexto sobre el alcance |
