---
title: "Contextual Greeting System Guide"
---



# GuÃ­a del Sistema de Saludo Contextual

> ðŸŒ EN | PT | **ES**

---

**Story:** 6.1.2.5 - Contextual Agent Load System
**Estado:** Componentes Implementados, IntegraciÃ³n Pendiente
**Fecha:** 2025-01-15

---

## DescripciÃ³n General

El Sistema de Saludo Contextual es una mejora de UX que hace que los saludos de los agentes AIOS sean inteligentes y adaptativos, mostrando informaciÃ³n y comandos relevantes basados en el contexto de la sesiÃ³n.

## Lo Que Se Ha Implementado

### Componentes Core (Story 6.1.2.5)

1. **ContextDetector** (`.aios-core/core/session/context-detector.js`)
   - Detecta tipo de sesiÃ³n: `new`, `existing`, o `workflow`
   - Enfoque hÃ­brido: historial de conversaciÃ³n (preferido) + archivo de sesiÃ³n (fallback)
   - TTL de 1 hora para sesiones inactivas

2. **GitConfigDetector** (`.aios-core/infrastructure/scripts/git-config-detector.js`)
   - Detecta configuraciÃ³n de git del proyecto
   - CachÃ© con TTL de 5 minutos
   - ProtecciÃ³n de timeout de 1000ms

3. **GreetingBuilder** (`.aios-core/development/scripts/greeting-builder.js`)
   - Construye saludos contextuales basados en el tipo de sesiÃ³n
   - Filtra comandos por visibilidad (full/quick/key)
   - Timeout de 150ms con fallback elegante

4. **WorkflowNavigator** (`.aios-core/development/scripts/workflow-navigator.js`)
   - Detecta estado del workflow actual
   - Sugiere prÃ³ximos comandos basado en el estado
   - Pre-popula comandos con contexto (story path, branch)

5. **Workflow Patterns** (`.aios-core/data/workflow-patterns.yaml`)
   - 10 workflows comunes definidos
   - Transiciones de estado con sugerencias de prÃ³ximos pasos
   - Patrones validados contra uso real del proyecto

### Pendiente (Story Futura - 6.1.4 o 6.1.6)

**IntegraciÃ³n con Proceso de ActivaciÃ³n:**
- Interceptar activaciÃ³n del agente (cuando escribes `@dev`, `@po`, etc.)
- Llamar GreetingBuilder automÃ¡ticamente
- Inyectar saludo contextual en lugar del saludo estÃ¡ndar

## Tipos de SesiÃ³n

### 1. New Session (SesiÃ³n Nueva)

**CuÃ¡ndo:** Primera interacciÃ³n o despuÃ©s de 1 hora de inactividad

**CaracterÃ­sticas:**
- PresentaciÃ³n completa (greeting archetypal)
- DescripciÃ³n del rol del agente
- Estado del proyecto (si git estÃ¡ configurado)
- Comandos completos (hasta 12 comandos con visibility=full)

**Ejemplo:**
```
ðŸ’» Dex (Builder) ready. Let's build something solid!

**Role:** Full Stack Developer specializing in clean, maintainable code

ðŸ“Š Project Status:
ðŸŒ¿ main
ðŸ“ 5 modified files
ðŸ“¦ Last commit: feat: implement greeting system

**Available Commands:**
   - `*help`: Show all available commands
   - `*develop`: Implement story tasks
   - `*review-code`: Review code changes
   - `*run-tests`: Execute test suite
   - `*build`: Build for production
   ... (hasta 12 comandos)
```

### 2. Existing Session (SesiÃ³n Existente)

**CuÃ¡ndo:** Continuando trabajo en la misma sesiÃ³n

**CaracterÃ­sticas:**
- PresentaciÃ³n resumida (greeting named)
- Estado del proyecto
- Contexto actual (Ãºltima acciÃ³n)
- Comandos rÃ¡pidos (6-8 comandos con visibility=quick)

**Ejemplo:**
```
ðŸ’» Dex (Builder) ready.

ðŸ“Š Project Status:
ðŸŒ¿ feature/story-6.1.2.5
ðŸ“ 3 modified files

ðŸ“Œ **Last Action:** review-code

**Quick Commands:**
   - `*help`: Show help
   - `*develop`: Implement story
   - `*review-code`: Review code
   - `*run-tests`: Run tests
   - `*qa-gate`: Run quality gate
   ... (6-8 comandos mÃ¡s usados)
```

### 3. Workflow Session (SesiÃ³n en Workflow)

**CuÃ¡ndo:** En medio de un workflow activo (ej: despuÃ©s de validar story)

**CaracterÃ­sticas:**
- PresentaciÃ³n mÃ­nima (greeting minimal)
- Estado condensado del proyecto
- Contexto del workflow (working on X)
- **Sugerencias de prÃ³ximos pasos** (NUEVO!)
- Comandos clave (3-5 comandos con visibility=key)

**Ejemplo:**
```
âš–ï¸ Pax ready.

ðŸ“Š ðŸŒ¿ main | ðŸ“ 5 modified | ðŸ“– STORY-6.1.2.5

ðŸ“Œ **Context:** Working on Story 6.1.2.5

**Story validated! Next steps:**

1. `*develop-yolo story-6.1.2.5.md` - Autonomous mode (no interruptions)
2. `*develop-interactive story-6.1.2.5.md` - Interactive mode with checkpoints
3. `*develop-preflight story-6.1.2.5.md` - Plan first, then execute

**Key Commands:**
   - `*help`: Show help
   - `*validate-story-draft`: Validate story
   - `*backlog-summary`: Quick backlog status
```

## Sistema de Visibilidad de Comandos

### Metadatos de Comandos

Cada comando ahora tiene un atributo `visibility` que controla cuÃ¡ndo aparece:

```yaml
commands:
  - name: help
    visibility: [full, quick, key]  # Siempre visible
    description: "Show all available commands"

  - name: develop
    visibility: [full, quick, key]  # Comando principal
    description: "Implement story tasks"

  - name: review-code
    visibility: [full, quick]  # Usado frecuentemente, pero no crÃ­tico
    description: "Review code changes"

  - name: build
    visibility: [full]  # Menos usado, solo en new session
    description: "Build for production"

  - name: qa-gate
    visibility: [key]  # CrÃ­tico en workflows, pero no siempre necesario
    description: "Run quality gate"
```

### GuÃ­as de CategorizaciÃ³n

**`full` (12 comandos)** - New Session
- Todos los comandos disponibles
- Muestra capacidades completas del agente
- Ideal para descubrimiento

**`quick` (6-8 comandos)** - Existing Session
- Comandos usados frecuentemente
- Enfocado en productividad
- Elimina comandos raramente usados

**`key` (3-5 comandos)** - Workflow Session
- Comandos crÃ­ticos para el workflow actual
- MÃ­nima distracciÃ³n
- MÃ¡xima eficiencia

## NavegaciÃ³n de Workflows

### Workflows Definidos

**10 workflows comunes:**

1. **story_development** - Validate -> Develop -> QA -> Deploy
2. **epic_creation** - Create epic -> Create stories -> Validate
3. **backlog_management** - Review -> Prioritize -> Schedule
4. **architecture_review** - Analyze -> Document -> Review
5. **git_workflow** - Quality gate -> PR -> Merge
6. **database_workflow** - Design -> Migrate -> Test
7. **code_quality_workflow** - Assess -> Refactor -> Test
8. **documentation_workflow** - Research -> Document -> Sync
9. **ux_workflow** - Design -> Implement -> Validate
10. **research_workflow** - Brainstorm -> Analyze -> Document

### Transiciones de Estado

Cada workflow define transiciones entre estados con:
- **Trigger:** Comando que se completa exitosamente
- **Greeting Message:** Mensaje contextual
- **Next Steps:** Sugerencias de prÃ³ximos comandos con args pre-populados

**Ejemplo (Story Development):**

```yaml
story_development:
  transitions:
    validated:
      trigger: "validate-story-draft completed successfully"
      greeting_message: "Story validated! Ready to implement."
      next_steps:
        - command: develop-yolo
          args_template: "${story_path}"
          description: "Autonomous YOLO mode (no interruptions)"
        - command: develop-interactive
          args_template: "${story_path}"
          description: "Interactive mode with checkpoints (default)"
        - command: develop-preflight
          args_template: "${story_path}"
          description: "Plan everything upfront, then execute"
```

## CÃ³mo Probar Ahora

### OpciÃ³n 1: Script de Prueba AutomÃ¡tico

```bash
node .aios-core/development/scripts/test-greeting-system.js
```

Este script prueba los 4 escenarios:
1. New session greeting (Dev)
2. Existing session greeting (Dev)
3. Workflow session greeting (PO)
4. Simple greeting fallback

### OpciÃ³n 2: Prueba Manual via Node REPL

```javascript
const GreetingBuilder = require('./.aios-core/development/scripts/greeting-builder');
const builder = new GreetingBuilder();

// Mock agent
const mockAgent = {
  name: 'Dex',
  icon: 'ðŸ’»',
  persona_profile: {
    greeting_levels: {
      named: 'ðŸ’» Dex (Builder) ready!'
    }
  },
  persona: { role: 'Developer' },
  commands: [
    { name: 'help', visibility: ['full', 'quick', 'key'] }
  ]
};

// Test new session
builder.buildGreeting(mockAgent, { conversationHistory: [] })
  .then(greeting => console.log(greeting));
```

### OpciÃ³n 3: Esperar IntegraciÃ³n Completa

Cuando la integraciÃ³n con el proceso de activaciÃ³n estÃ© implementada (Story 6.1.4/6.1.6), el sistema funcionarÃ¡ automÃ¡ticamente al activar cualquier agente:

```
@dev              â†’ Saludo contextual automÃ¡tico
@po               â†’ Saludo contextual automÃ¡tico
@qa               â†’ Saludo contextual automÃ¡tico
```

## Archivos Relacionados

### Scripts Core
- `.aios-core/core/session/context-detector.js` - DetecciÃ³n de tipo de sesiÃ³n
- `.aios-core/infrastructure/scripts/git-config-detector.js` - DetecciÃ³n de git config
- `.aios-core/development/scripts/greeting-builder.js` - ConstrucciÃ³n del saludo
- `.aios-core/development/scripts/workflow-navigator.js` - NavegaciÃ³n de workflow
- `.aios-core/development/scripts/agent-exit-hooks.js` - Hooks de salida (para persistencia)

### Archivos de Datos
- `.aios-core/data/workflow-patterns.yaml` - Definiciones de workflows

### Tests
- `tests/unit/context-detector.test.js` - 23 tests
- `tests/unit/git-config-detector.test.js` - 19 tests
- `tests/unit/greeting-builder.test.js` - 23 tests
- `tests/integration/performance.test.js` - ValidaciÃ³n de rendimiento

### ConfiguraciÃ³n
- `.aios-core/core-config.yaml` - ConfiguraciÃ³n global (secciones git + agentIdentity)

### Agentes (Actualizados)
- `.aios-core/agents/dev.md` - Metadatos de visibilidad de comandos
- `.aios-core/agents/po.md` - Metadatos de visibilidad de comandos
- `.aios-core/agents/*.md` - 9 agentes restantes (actualizaciÃ³n pendiente)

## PrÃ³ximos Pasos

### Inmediato (Arreglar Problemas de Tests)
1. Arreglar problemas de configuraciÃ³n de tests (1-2 horas)
2. Ejecutar suite completa de tests
3. Ejecutar tests de rendimiento

### Corto Plazo (Story 6.1.4 o 6.1.6)
1. Implementar integraciÃ³n con proceso de activaciÃ³n de agentes
2. Actualizar los 9 agentes restantes con metadatos de visibilidad de comandos
3. Probar con activaciones reales de agentes

### Largo Plazo (Story 6.1.2.6)
1. Implementar aprendizaje dinÃ¡mico de patrones de workflow
2. Agregar priorizaciÃ³n de comandos basada en uso
3. Implementar hints de colaboraciÃ³n entre agentes

## MÃ©tricas de Rendimiento

**Objetivo (de Story 6.1.2.5):**
- Latencia P50: &lt;100ms
- Latencia P95: &lt;130ms
- Latencia P99: &lt;150ms (lÃ­mite duro)

**Esperado (basado en revisiÃ³n de cÃ³digo):**
- Git config (cache hit): &lt;5ms
- Git config (cache miss): &lt;50ms
- DetecciÃ³n de contexto: &lt;50ms
- I/O de archivo de sesiÃ³n: &lt;10ms
- Matching de workflow: &lt;20ms
- **Total P99:** ~100-120ms (bien por debajo del lÃ­mite)

**Optimizaciones:**
- EjecuciÃ³n paralela (Promise.all)
- Caching basado en TTL
- ProtecciÃ³n de timeout
- Salida temprana en cache hit

## Compatibilidad Hacia AtrÃ¡s

**100% Compatible Hacia AtrÃ¡s:**
- Agentes sin metadatos de visibilidad muestran todos los comandos (mÃ¡ximo 12)
- Fallback elegante a saludo simple en cualquier error
- Cero cambios breaking en el proceso de activaciÃ³n
- MigraciÃ³n gradual (Fase 1: dev/po -> Fase 2: 9 restantes)

## Preguntas Frecuentes

**P: Â¿Por quÃ© el saludo no es contextual cuando activo un agente ahora?**
R: La integraciÃ³n con el proceso de activaciÃ³n aÃºn no se ha implementado. Los componentes existen pero no se llaman automÃ¡ticamente todavÃ­a.

**P: Â¿CuÃ¡ndo se harÃ¡ la integraciÃ³n?**
R: En una story futura (probablemente 6.1.4 o 6.1.6). Depende del sistema de configuraciÃ³n de agentes.

**P: Â¿CÃ³mo puedo probar ahora?**
R: Usa el script de prueba: `node .aios-core/development/scripts/test-greeting-system.js`

**P: Â¿QuÃ© pasa si un agente no tiene metadatos de visibilidad?**
R: Fallback: muestra todos los comandos (mÃ¡ximo 12). No rompe nada.

**P: Â¿CÃ³mo agrego metadatos de visibilidad a mis comandos?**
R: Mira la secciÃ³n "Sistema de Visibilidad de Comandos" arriba y los ejemplos en los agentes dev.md y po.md.

**P: Â¿Puedo deshabilitar el saludo contextual?**
R: SÃ­, via config: `core-config.yaml` -> `agentIdentity.greeting.contextDetection: false`

---

**Documento Actualizado:** 2025-01-15
**Autor:** Quinn (QA) + Dex (Dev)
**Story:** 6.1.2.5 - Contextual Agent Load System
