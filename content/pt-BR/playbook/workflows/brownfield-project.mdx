# Projeto Brownfield

Entrando ou aprimorando um codebase existente com o AIOS. Este guia cobre o processo de avaliacao Brownfield Discovery de 10 fases e as tres variantes de implementacao para projetos existentes.

## Quando Usar um Workflow Brownfield

Use um workflow brownfield quando estiver trabalhando com um codebase existente. Cenarios tipicos incluem:

- Migrar projetos do Lovable, v0.dev ou outro codigo gerado por IA
- Auditar e modernizar um codebase legado
- Adicionar novas funcionalidades significativas a uma aplicacao existente
- Due diligence tecnica pre-investimento
- Onboarding em um projeto construido por outra equipe

## Brownfield Discovery: Avaliacao de 10 Fases

Antes de fazer alteracoes em um projeto existente, execute o workflow Brownfield Discovery para produzir uma avaliacao abrangente de divida tecnica. Este e o primeiro passo recomendado para qualquer engajamento brownfield.

```
*workflow brownfield-discovery
```

**Duracao estimada:** 4-8 horas dependendo da complexidade do projeto.

### Coleta de Dados (Fases 1-3)

| Fase | Agente | Produz | Notas |
|------|--------|--------|-------|
| 1. Arquitetura do Sistema | @architect (Aria) | `docs/architecture/system-architecture.md` | Analisa stack, dependencias, padroes de codigo, integracoes |
| 2. Auditoria de Banco de Dados | @data-engineer (Dara) | `supabase/docs/SCHEMA.md`, `DB-AUDIT.md` | Ignorada se o projeto nao tiver banco de dados |
| 3. Spec de Frontend/UX | @ux-expert (Uma) | `docs/frontend/frontend-spec.md` | Componentes, design system, acessibilidade, responsividade |

### Rascunho e Validacao (Fases 4-7)

| Fase | Agente | Produz | Notas |
|------|--------|--------|-------|
| 4. Consolidacao Inicial | @architect (Aria) | `docs/prd/technical-debt-DRAFT.md` | Unifica todos os achados em um unico DRAFT |
| 5. Revisao Especialista BD | @data-engineer (Dara) | `docs/reviews/db-specialist-review.md` | Valida, estima e prioriza dividas de BD |
| 6. Revisao Especialista UX | @ux-expert (Uma) | `docs/reviews/ux-specialist-review.md` | Valida, estima e prioriza dividas de UX |
| 7. QA Gate | @qa (Quinn) | `docs/reviews/qa-review.md` | Quality gate: APPROVED ou NEEDS WORK |

Se o QA gate retornar **NEEDS WORK**, o processo retorna a Fase 4 para retrabalho. O architect incorpora o feedback do QA, e o rascunho passa por revisoes especialistas novamente.

### Finalizacao (Fases 8-10)

| Fase | Agente | Produz | Notas |
|------|--------|--------|-------|
| 8. Avaliacao Final | @architect (Aria) | `docs/prd/technical-debt-assessment.md` | Incorpora todas as revisoes especialistas |
| 9. Relatorio Executivo | @analyst (Atlas) | `docs/reports/TECHNICAL-DEBT-REPORT.md` | Analise de custos, ROI, timeline para stakeholders |
| 10. Planejamento | @pm (Morgan) | Epic + stories | Cria stories de desenvolvimento acionaveis |

### Estrutura de Saida do Discovery

Apos a conclusao do workflow de descoberta, seu diretorio `docs/` contera:

```
docs/
  architecture/
    system-architecture.md        # Fase 1
  frontend/
    frontend-spec.md              # Fase 3
  reviews/
    db-specialist-review.md       # Fase 5
    ux-specialist-review.md       # Fase 6
    qa-review.md                  # Fase 7
  prd/
    technical-debt-DRAFT.md       # Fase 4
    technical-debt-assessment.md  # Fase 8
  reports/
    TECHNICAL-DEBT-REPORT.md      # Fase 9
  stories/
    epic-technical-debt.md        # Fase 10
    story-1.1-*.md
```

## Variantes de Implementacao

Apos o discovery (ou para aprimoramentos que nao exigem uma descoberta completa), o AIOS oferece tres workflows de implementacao brownfield:

| Variante | Comando | Ideal Para |
|----------|---------|------------|
| **Full-Stack** | `*workflow brownfield-fullstack` | Aprimoramentos que envolvem frontend e backend |
| **Service/API** | `*workflow brownfield-service` | Modernizacao de servicos backend, aprimoramentos de API |
| **UI Only** | `*workflow brownfield-ui` | Modernizacao de frontend, redesign, aprimoramentos de UI |

### Classificacao de Enhancement

Os workflows brownfield full-stack e service comecam com uma etapa de classificacao pelo @analyst:

| Tamanho | Stories | Rota |
|---------|---------|------|
| Story Unica | 1 (menos de 4 horas) | `@pm *brownfield-create-story` -- sai do workflow |
| Feature Pequena | 1-3 stories | `@pm *brownfield-create-epic` -- sai do workflow |
| Enhancement Grande | Multiplos epics | Continua pelo workflow completo de planejamento |

Para enhancements grandes, o workflow verifica a adequacao da documentacao existente. Se a documentacao estiver desatualizada ou ausente, `@architect *document-project` e executado primeiro.

### Fases de Implementacao

Todas as variantes de implementacao brownfield compartilham estas fases:

1. **Planejamento** -- @architect analisa o sistema existente; @pm cria um PRD brownfield; @architect cria arquitetura (se mudancas arquiteturais forem necessarias)
2. **Validacao** -- @po valida todos os artefatos com o po-master-checklist; problemas sao corrigidos pelo agente relevante
3. **Ciclo de Desenvolvimento** -- @po fragmenta documentos; @sm cria stories; @dev implementa; @qa revisa
4. **Finalizacao** -- Retrospectiva de epic opcional pelo @po

### Consideracoes Especificas de Brownfield

Diferente dos workflows greenfield, os workflows brownfield incluem salvaguardas adicionais:

- **Validacao de seguranca de integracao** -- @po verifica que mudancas nao quebrarao funcionalidades existentes
- **Avaliacao de risco de regressao** -- @qa avalia o risco de regressoes
- **Feature flags** -- Considere rollout gradual para mudancas significativas
- **Padroes existentes** -- Decisoes de arquitetura respeitam padroes de codigo existentes quando possivel

## Comandos de Inicio Rapido

```
# Avaliacao completa de divida tecnica (primeiro passo recomendado)
*workflow brownfield-discovery

# Aprimoramento full-stack
*workflow brownfield-fullstack

# Aprimoramento de servico backend
*workflow brownfield-service

# Aprimoramento de frontend/UI
*workflow brownfield-ui

# Rapido: criar uma unica story brownfield
@pm *brownfield-create-story

# Rapido: criar um pequeno epic brownfield (1-3 stories)
@pm *brownfield-create-epic
```

## Priorizacao Apos o Discovery

Apos completar o Brownfield Discovery, trabalhe com @po para priorizar stories com base em:

- **Impacto no negocio** -- Quais dividas afetam mais os usuarios
- **Risco tecnico** -- Vulnerabilidades de seguranca e problemas de integridade de dados primeiro
- **Dependencias** -- Resolva dividas bloqueantes antes das dependentes
- **Quick wins** -- Itens de baixo esforco e alto impacto para gerar momentum

## Solucao de Problemas

| Problema | Solucao |
|----------|---------|
| Auditoria de banco de dados falha | Verifique a variavel de ambiente `SUPABASE_DB_URL` e o acesso a rede |
| Avaliacao muito grande (50+ dividas) | Priorize por severidade; agrupe dividas similares; considere multiplos epics |
| QA gate em loop (NEEDS WORK repetido) | Foque nas lacunas especificas identificadas pelo @qa; considere aprovar com condicoes documentadas |
| Especialistas discordam nas prioridades | @architect media; use frameworks objetivos de priorizacao (RICE, ICE) |
| Enhancement mal classificado | Re-execute a classificacao com @analyst fornecendo mais contexto sobre o escopo |
