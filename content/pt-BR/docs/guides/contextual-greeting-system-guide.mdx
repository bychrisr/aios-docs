---
title: "Contextual Greeting System Guide"
---



# Guia do Sistema de Greeting Contextual

> ðŸŒ EN | **PT** | ES

---

**Story:** 6.1.2.5 - Contextual Agent Load System
**Status:** Componentes Implementados, IntegraÃ§Ã£o Pendente
**Data:** 2025-01-15

---

## VisÃ£o Geral

O Sistema de Greeting Contextual Ã© uma melhoria de UX que torna os greetings dos agentes AIOS inteligentes e adaptativos, mostrando informaÃ§Ãµes e comandos relevantes baseados no contexto da sessÃ£o.

## O Que Foi Implementado

### Componentes Core (Story 6.1.2.5)

1. **ContextDetector** (`.aios-core/core/session/context-detector.js`)
   - Detecta tipo de sessÃ£o: `new`, `existing`, ou `workflow`
   - Abordagem hÃ­brida: histÃ³rico de conversaÃ§Ã£o (preferido) + arquivo de sessÃ£o (fallback)
   - TTL de 1 hora para sessÃµes inativas

2. **GitConfigDetector** (`.aios-core/infrastructure/scripts/git-config-detector.js`)
   - Detecta configuraÃ§Ã£o do git do projeto
   - Cache com TTL de 5 minutos
   - ProteÃ§Ã£o de timeout de 1000ms

3. **GreetingBuilder** (`.aios-core/development/scripts/greeting-builder.js`)
   - Monta greetings contextuais baseados no tipo de sessÃ£o
   - Filtra comandos por visibilidade (full/quick/key)
   - Timeout de 150ms com fallback gracioso

4. **WorkflowNavigator** (`.aios-core/development/scripts/workflow-navigator.js`)
   - Detecta estado do workflow atual
   - Sugere prÃ³ximos comandos baseado no estado
   - Pre-popula comandos com contexto (story path, branch)

5. **Workflow Patterns** (`.aios-core/data/workflow-patterns.yaml`)
   - 10 workflows comuns definidos
   - TransiÃ§Ãµes de estado com sugestÃµes de prÃ³ximos passos
   - PadrÃµes validados contra uso real do projeto

### Pendente (Story Futura - 6.1.4 ou 6.1.6)

**IntegraÃ§Ã£o com Processo de AtivaÃ§Ã£o:**
- Interceptar ativaÃ§Ã£o do agente (quando vocÃª digita `@dev`, `@po`, etc.)
- Chamar GreetingBuilder automaticamente
- Injetar greeting contextual no lugar do greeting padrÃ£o

## Tipos de SessÃ£o

### 1. New Session (SessÃ£o Nova)

**Quando:** Primeira interaÃ§Ã£o ou apÃ³s 1 hora de inatividade

**CaracterÃ­sticas:**
- ApresentaÃ§Ã£o completa (greeting archetypal)
- DescriÃ§Ã£o do papel do agente
- Status do projeto (se git configurado)
- Comandos completos (atÃ© 12 comandos com visibility=full)

**Exemplo:**
```
Dex (Builder) ready. Let's build something solid!

**Role:** Full Stack Developer specializing in clean, maintainable code

Project Status:
main
5 modified files
Last commit: feat: implement greeting system

**Available Commands:**
   - `*help`: Show all available commands
   - `*develop`: Implement story tasks
   - `*review-code`: Review code changes
   - `*run-tests`: Execute test suite
   - `*build`: Build for production
   ... (atÃ© 12 comandos)
```

### 2. Existing Session (SessÃ£o Existente)

**Quando:** Continuando trabalho na mesma sessÃ£o

**CaracterÃ­sticas:**
- ApresentaÃ§Ã£o resumida (greeting named)
- Status do projeto
- Contexto atual (Ãºltima aÃ§Ã£o)
- Comandos rÃ¡pidos (6-8 comandos com visibility=quick)

**Exemplo:**
```
Dex (Builder) ready.

Project Status:
feature/story-6.1.2.5
3 modified files

**Last Action:** review-code

**Quick Commands:**
   - `*help`: Show help
   - `*develop`: Implement story
   - `*review-code`: Review code
   - `*run-tests`: Run tests
   - `*qa-gate`: Run quality gate
   ... (6-8 comandos mais usados)
```

### 3. Workflow Session (SessÃ£o em Workflow)

**Quando:** No meio de um workflow ativo (ex: apÃ³s validar story)

**CaracterÃ­sticas:**
- ApresentaÃ§Ã£o mÃ­nima (greeting minimal)
- Status condensado do projeto
- Contexto do workflow (working on X)
- **SugestÃµes de prÃ³ximos passos** (NEW!)
- Comandos chave (3-5 comandos com visibility=key)

**Exemplo:**
```
Pax ready.

main | 5 modified | STORY-6.1.2.5

**Context:** Working on Story 6.1.2.5

**Story validated! Next steps:**

1. `*develop-yolo story-6.1.2.5.md` - Autonomous mode (no interruptions)
2. `*develop-interactive story-6.1.2.5.md` - Interactive mode with checkpoints
3. `*develop-preflight story-6.1.2.5.md` - Plan first, then execute

**Key Commands:**
   - `*help`: Show help
   - `*validate-story-draft`: Validate story
   - `*backlog-summary`: Quick backlog status
```

## Sistema de Visibilidade de Comandos

### Metadados de Comandos

Cada comando agora tem um atributo `visibility` que controla quando ele aparece:

```yaml
commands:
  - name: help
    visibility: [full, quick, key]  # Sempre visÃ­vel
    description: "Show all available commands"

  - name: develop
    visibility: [full, quick, key]  # Comando principal
    description: "Implement story tasks"

  - name: review-code
    visibility: [full, quick]  # Usado frequentemente, mas nÃ£o crÃ­tico
    description: "Review code changes"

  - name: build
    visibility: [full]  # Menos usado, sÃ³ em new session
    description: "Build for production"

  - name: qa-gate
    visibility: [key]  # CrÃ­tico em workflows, mas nÃ£o sempre necessÃ¡rio
    description: "Run quality gate"
```

### Guidelines de CategorizaÃ§Ã£o

**`full` (12 comandos)** - New Session
- Todos os comandos disponÃ­veis
- Mostra capacidades completas do agente
- Ideal para descoberta

**`quick` (6-8 comandos)** - Existing Session
- Comandos usados frequentemente
- Focado em produtividade
- Remove comandos raramente usados

**`key` (3-5 comandos)** - Workflow Session
- Comandos crÃ­ticos para o workflow atual
- MÃ­nimo de distraÃ§Ã£o
- MÃ¡xima eficiÃªncia

## NavegaÃ§Ã£o de Workflow

### Workflows Definidos

**10 workflows comuns:**

1. **story_development** - Validate -> Develop -> QA -> Deploy
2. **epic_creation** - Create epic -> Create stories -> Validate
3. **backlog_management** - Review -> Prioritize -> Schedule
4. **architecture_review** - Analyze -> Document -> Review
5. **git_workflow** - Quality gate -> PR -> Merge
6. **database_workflow** - Design -> Migrate -> Test
7. **code_quality_workflow** - Assess -> Refactor -> Test
8. **documentation_workflow** - Research -> Document -> Sync
9. **ux_workflow** - Design -> Implement -> Validate
10. **research_workflow** - Brainstorm -> Analyze -> Document

### TransiÃ§Ãµes de Estado

Cada workflow define transiÃ§Ãµes entre estados com:
- **Trigger:** Comando que completa com sucesso
- **Greeting Message:** Mensagem contextual
- **Next Steps:** SugestÃµes de prÃ³ximos comandos com args prÃ©-populados

**Exemplo (Story Development):**

```yaml
story_development:
  transitions:
    validated:
      trigger: "validate-story-draft completed successfully"
      greeting_message: "Story validated! Ready to implement."
      next_steps:
        - command: develop-yolo
          args_template: "${story_path}"
          description: "Autonomous YOLO mode (no interruptions)"
        - command: develop-interactive
          args_template: "${story_path}"
          description: "Interactive mode with checkpoints (default)"
        - command: develop-preflight
          args_template: "${story_path}"
          description: "Plan everything upfront, then execute"
```

## Como Testar Agora

### OpÃ§Ã£o 1: Script de Teste AutomÃ¡tico

```bash
node .aios-core/development/scripts/test-greeting-system.js
```

Este script testa os 4 cenÃ¡rios:
1. New session greeting (Dev)
2. Existing session greeting (Dev)
3. Workflow session greeting (PO)
4. Simple greeting fallback

### OpÃ§Ã£o 2: Teste Manual via Node REPL

```javascript
const GreetingBuilder = require('./.aios-core/development/scripts/greeting-builder');
const builder = new GreetingBuilder();

// Mock agent
const mockAgent = {
  name: 'Dex',
  icon: '',
  persona_profile: {
    greeting_levels: {
      named: 'Dex (Builder) ready!'
    }
  },
  persona: { role: 'Developer' },
  commands: [
    { name: 'help', visibility: ['full', 'quick', 'key'] }
  ]
};

// Test new session
builder.buildGreeting(mockAgent, { conversationHistory: [] })
  .then(greeting => console.log(greeting));
```

### OpÃ§Ã£o 3: Aguardar IntegraÃ§Ã£o Completa

Quando a integraÃ§Ã£o com o processo de ativaÃ§Ã£o estiver implementada (Story 6.1.4/6.1.6), o sistema funcionarÃ¡ automaticamente ao ativar qualquer agente:

```
@dev              -> Greeting contextual automÃ¡tico
@po               -> Greeting contextual automÃ¡tico
@qa               -> Greeting contextual automÃ¡tico
```

## Arquivos Relacionados

### Scripts Core
- `.aios-core/core/session/context-detector.js` - DetecÃ§Ã£o de tipo de sessÃ£o
- `.aios-core/infrastructure/scripts/git-config-detector.js` - DetecÃ§Ã£o de git config
- `.aios-core/development/scripts/greeting-builder.js` - Montagem do greeting
- `.aios-core/development/scripts/workflow-navigator.js` - NavegaÃ§Ã£o de workflow
- `.aios-core/development/scripts/agent-exit-hooks.js` - Hooks de saÃ­da (para persistÃªncia)

### Arquivos de Dados
- `.aios-core/data/workflow-patterns.yaml` - DefiniÃ§Ãµes de workflows

### Testes
- `tests/unit/context-detector.test.js` - 23 testes
- `tests/unit/git-config-detector.test.js` - 19 testes
- `tests/unit/greeting-builder.test.js` - 23 testes
- `tests/integration/performance.test.js` - ValidaÃ§Ã£o de performance

### ConfiguraÃ§Ã£o
- `.aios-core/core-config.yaml` - ConfiguraÃ§Ã£o global (seÃ§Ãµes git + agentIdentity)

### Agentes (Atualizados)
- `.aios-core/agents/dev.md` - Metadata de visibilidade de comandos
- `.aios-core/agents/po.md` - Metadata de visibilidade de comandos
- `.aios-core/agents/*.md` - 9 agentes restantes (atualizaÃ§Ã£o pendente)

## PrÃ³ximos Passos

### Imediato (Corrigir Problemas de Testes)
1. Corrigir problemas de configuraÃ§Ã£o de testes (1-2 horas)
2. Executar suite completa de testes
3. Executar testes de performance

### Curto Prazo (Story 6.1.4 ou 6.1.6)
1. Implementar integraÃ§Ã£o com processo de ativaÃ§Ã£o de agentes
2. Atualizar 9 agentes restantes com metadata de visibilidade de comandos
3. Testar com ativaÃ§Ãµes reais de agentes

### Longo Prazo (Story 6.1.2.6)
1. Implementar aprendizado dinÃ¢mico de padrÃµes de workflow
2. Adicionar priorizaÃ§Ã£o de comandos baseada em uso
3. Implementar dicas de colaboraÃ§Ã£o entre agentes

## MÃ©tricas de Performance

**Alvo (da Story 6.1.2.5):**
- LatÃªncia P50: &lt;100ms
- LatÃªncia P95: &lt;130ms
- LatÃªncia P99: &lt;150ms (limite rÃ­gido)

**Esperado (baseado em revisÃ£o de cÃ³digo):**
- Git config (cache hit): &lt;5ms
- Git config (cache miss): &lt;50ms
- DetecÃ§Ã£o de contexto: &lt;50ms
- I/O de arquivo de sessÃ£o: &lt;10ms
- Matching de workflow: &lt;20ms
- **Total P99:** ~100-120ms (bem abaixo do limite)

**OtimizaÃ§Ãµes:**
- ExecuÃ§Ã£o paralela (Promise.all)
- Cache baseado em TTL
- ProteÃ§Ã£o de timeout
- SaÃ­da antecipada em cache hit

## Compatibilidade Retroativa

**100% CompatÃ­vel:**
- Agentes sem metadata de visibilidade mostram todos os comandos (max 12)
- Fallback gracioso para simple greeting em qualquer erro
- Zero breaking changes no processo de ativaÃ§Ã£o
- MigraÃ§Ã£o gradual (Fase 1: dev/po -> Fase 2: 9 restantes)

## FAQ

**P: Por que o greeting nÃ£o estÃ¡ contextual quando ativo um agente agora?**
R: A integraÃ§Ã£o com o processo de ativaÃ§Ã£o ainda nÃ£o foi implementada. Os componentes existem mas nÃ£o sÃ£o chamados automaticamente ainda.

**P: Quando a integraÃ§Ã£o serÃ¡ feita?**
R: Em uma story futura (provavelmente 6.1.4 ou 6.1.6). Depende do sistema de configuraÃ§Ã£o de agentes.

**P: Como posso testar agora?**
R: Use o script de teste: `node .aios-core/development/scripts/test-greeting-system.js`

**P: O que acontece se um agente nÃ£o tiver metadata de visibilidade?**
R: Fallback: mostra todos os comandos (max 12). NÃ£o quebra nada.

**P: Como adiciono metadata de visibilidade nos meus comandos?**
R: Veja a seÃ§Ã£o "Sistema de Visibilidade de Comandos" acima e os exemplos nos agents dev.md e po.md.

**P: Posso desabilitar o greeting contextual?**
R: Sim, via config: `core-config.yaml` -> `agentIdentity.greeting.contextDetection: false`

---

**Documento Atualizado:** 2025-01-15
**Autor:** Quinn (QA) + Dex (Dev)
**Story:** 6.1.2.5 - Contextual Agent Load System
