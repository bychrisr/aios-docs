# Brownfield Project

Joining or enhancing an existing codebase with AIOS. This guide covers the Brownfield Discovery assessment process and the three implementation workflow variants for existing projects.

## When to Use a Brownfield Workflow

Use a brownfield workflow when you are working with an existing codebase. Typical scenarios include:

- Migrating projects from Lovable, v0.dev, or other AI-generated code
- Auditing and modernizing a legacy codebase
- Adding significant new features to an existing application
- Pre-investment technical due diligence
- Onboarding into a project built by another team

## Brownfield Discovery: 10-Phase Assessment

Before making changes to an existing project, run the Brownfield Discovery workflow to produce a comprehensive technical debt assessment. This is the recommended first step for any brownfield engagement.

```
*workflow brownfield-discovery
```

**Estimated duration:** 4-8 hours depending on project complexity.

### Data Collection (Phases 1-3)

| Phase | Agent | Produces | Notes |
|-------|-------|----------|-------|
| 1. System Architecture | @architect (Aria) | `docs/architecture/system-architecture.md` | Analyzes stack, dependencies, code patterns, integrations |
| 2. Database Audit | @data-engineer (Dara) | `supabase/docs/SCHEMA.md`, `DB-AUDIT.md` | Skipped if project has no database |
| 3. Frontend/UX Spec | @ux-expert (Uma) | `docs/frontend/frontend-spec.md` | Components, design system, accessibility, responsiveness |

### Draft and Validation (Phases 4-7)

| Phase | Agent | Produces | Notes |
|-------|-------|----------|-------|
| 4. Initial Consolidation | @architect (Aria) | `docs/prd/technical-debt-DRAFT.md` | Merges all findings into a single DRAFT |
| 5. DB Specialist Review | @data-engineer (Dara) | `docs/reviews/db-specialist-review.md` | Validates, estimates, and prioritizes DB debts |
| 6. UX Specialist Review | @ux-expert (Uma) | `docs/reviews/ux-specialist-review.md` | Validates, estimates, and prioritizes UX debts |
| 7. QA Gate | @qa (Quinn) | `docs/reviews/qa-review.md` | Quality gate: APPROVED or NEEDS WORK |

If the QA gate returns **NEEDS WORK**, the process returns to Phase 4 for rework. The architect incorporates the QA feedback, and the draft goes through specialist reviews again.

### Finalization (Phases 8-10)

| Phase | Agent | Produces | Notes |
|-------|-------|----------|-------|
| 8. Final Assessment | @architect (Aria) | `docs/prd/technical-debt-assessment.md` | Incorporates all specialist reviews |
| 9. Executive Report | @analyst (Atlas) | `docs/reports/TECHNICAL-DEBT-REPORT.md` | Cost analysis, ROI, timeline for stakeholders |
| 10. Planning | @pm (Morgan) | Epic + stories | Creates actionable development stories |

### Discovery Output Structure

After the discovery workflow completes, your `docs/` directory will contain:

```
docs/
  architecture/
    system-architecture.md        # Phase 1
  frontend/
    frontend-spec.md              # Phase 3
  reviews/
    db-specialist-review.md       # Phase 5
    ux-specialist-review.md       # Phase 6
    qa-review.md                  # Phase 7
  prd/
    technical-debt-DRAFT.md       # Phase 4
    technical-debt-assessment.md  # Phase 8
  reports/
    TECHNICAL-DEBT-REPORT.md      # Phase 9
  stories/
    epic-technical-debt.md        # Phase 10
    story-1.1-*.md
```

## Implementation Variants

After discovery (or for enhancements that do not require a full discovery), AIOS provides three brownfield implementation workflows:

| Variant | Command | Best For |
|---------|---------|----------|
| **Full-Stack** | `*workflow brownfield-fullstack` | Enhancements touching both frontend and backend |
| **Service/API** | `*workflow brownfield-service` | Backend service modernization, API enhancements |
| **UI Only** | `*workflow brownfield-ui` | Frontend modernization, design refresh, UI enhancements |

### Enhancement Classification

The brownfield full-stack and service workflows begin with an enhancement classification step by @analyst:

| Size | Stories | Route |
|------|---------|-------|
| Single Story | 1 (under 4 hours) | `@pm *brownfield-create-story` -- exits workflow |
| Small Feature | 1-3 stories | `@pm *brownfield-create-epic` -- exits workflow |
| Major Enhancement | Multiple epics | Continues through the full planning workflow |

For major enhancements, the workflow checks existing documentation adequacy. If documentation is outdated or missing, `@architect *document-project` runs first.

### Implementation Phases

All brownfield implementation variants share these phases:

1. **Planning** -- @architect analyzes the existing system; @pm creates a brownfield PRD; @architect creates architecture (if architectural changes are needed)
2. **Validation** -- @po validates all artifacts with the po-master-checklist; issues are fixed by the relevant agent
3. **Development Cycle** -- @po shards documents; @sm creates stories; @dev implements; @qa reviews
4. **Finalization** -- Optional epic retrospective by @po

### Brownfield-Specific Considerations

Unlike greenfield workflows, brownfield workflows include additional safeguards:

- **Integration safety validation** -- @po checks that changes will not break existing functionality
- **Regression risk assessment** -- @qa evaluates risk of regressions
- **Feature flags** -- Consider gradual rollout for major changes
- **Existing patterns** -- Architecture decisions respect existing code patterns when possible

## Quick Start Commands

```
# Full technical debt assessment (recommended first step)
*workflow brownfield-discovery

# Full-stack enhancement
*workflow brownfield-fullstack

# Backend service enhancement
*workflow brownfield-service

# Frontend/UI enhancement
*workflow brownfield-ui

# Quick: create a single brownfield story
@pm *brownfield-create-story

# Quick: create a small brownfield epic (1-3 stories)
@pm *brownfield-create-epic
```

## Prioritization After Discovery

After completing the Brownfield Discovery, work with @po to prioritize stories based on:

- **Business impact** -- Which debts affect users the most
- **Technical risk** -- Security vulnerabilities and data integrity issues first
- **Dependencies** -- Resolve blocking debts before dependent ones
- **Quick wins** -- Low-effort, high-impact items for early momentum

## Troubleshooting

| Problem | Solution |
|---------|----------|
| Database audit fails | Check `SUPABASE_DB_URL` environment variable and network access |
| Assessment too large (50+ debts) | Prioritize by severity; group similar debts; consider multiple epics |
| QA gate loops (NEEDS WORK repeated) | Focus on specific gaps identified by @qa; consider approving with documented conditions |
| Specialists disagree on priorities | @architect mediates; use objective prioritization frameworks (RICE, ICE) |
| Enhancement misclassified | Re-run classification with @analyst providing more context about scope |
