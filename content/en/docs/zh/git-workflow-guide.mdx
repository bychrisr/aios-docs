---
title: "Git Workflow Guide"
---

# AIOS Git å·¥ä½œæµæŒ‡å—

> ğŸŒ [EN](../git-workflow-guide.md) | [PT](../pt/git-workflow-guide.md) | [ES](../es/git-workflow-guide.md)

---

_Story: 2.2-git-workflow-implementation.yaml_

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [çºµæ·±é˜²å¾¡æ¶æ„](#çºµæ·±é˜²å¾¡æ¶æ„)
- [ç¬¬ä¸€å±‚ï¼šæäº¤å‰éªŒè¯](#ç¬¬ä¸€å±‚æäº¤å‰éªŒè¯)
- [ç¬¬äºŒå±‚ï¼šæ¨é€å‰éªŒè¯](#ç¬¬äºŒå±‚æ¨é€å‰éªŒè¯)
- [ç¬¬ä¸‰å±‚ï¼šCI/CD æµç¨‹](#ç¬¬ä¸‰å±‚cicd-æµç¨‹)
- [åˆ†æ”¯ä¿æŠ¤](#åˆ†æ”¯ä¿æŠ¤)
- [æ—¥å¸¸å·¥ä½œæµ](#æ—¥å¸¸å·¥ä½œæµ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æ€§èƒ½æç¤º](#æ€§èƒ½æç¤º)

## æ¦‚è¿°

Synkra AIOS å®ç°äº†**çºµæ·±é˜²å¾¡**éªŒè¯ç­–ç•¥ï¼Œå…·æœ‰ä¸‰ä¸ªæ¸è¿›å¼å±‚çº§ï¼Œå¯ä»¥ææ—©å‘ç°é—®é¢˜å¹¶ç¡®ä¿ä»£ç è´¨é‡åœ¨åˆå¹¶ä¹‹å‰ã€‚

### ä¸ºä»€ä¹ˆæ˜¯ä¸‰å±‚ï¼Ÿ

1. **å¿«é€Ÿåé¦ˆ** - åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç«‹å³å‘ç°é—®é¢˜
2. **æœ¬åœ°éªŒè¯** - åŸºæœ¬æ£€æŸ¥ä¸ä¾èµ–äº‘
3. **æƒå¨éªŒè¯** - åˆå¹¶å‰çš„æœ€ç»ˆé—¨å…³
4. **æ•…äº‹ä¸€è‡´æ€§** - ç¡®ä¿å¼€å‘ä¸æ•…äº‹ä¸€è‡´

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼€å‘å·¥ä½œæµ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±‚çº§ 1ï¼šæäº¤å‰é’©å­ (æœ¬åœ° - <5ç§’)                            â”‚
â”‚ âœ“ ESLint (ä»£ç è´¨é‡)                                         â”‚
â”‚ âœ“ TypeScript (ç±»å‹æ£€æŸ¥)                                     â”‚
â”‚ âœ“ ç¼“å­˜å¯ç”¨                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±‚çº§ 2ï¼šæ¨é€å‰é’©å­ (æœ¬åœ° - <2ç§’)                            â”‚
â”‚ âœ“ æ•…äº‹å¤é€‰æ¡†éªŒè¯                                            â”‚
â”‚ âœ“ çŠ¶æ€ä¸€è‡´æ€§                                                â”‚
â”‚ âœ“ å¿…éœ€éƒ¨åˆ†                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±‚çº§ 3ï¼šGitHub Actions CI (äº‘ - 2-5åˆ†é’Ÿ)                    â”‚
â”‚ âœ“ æ‰€æœ‰ lint/type æ£€æŸ¥                                       â”‚
â”‚ âœ“ å®Œæ•´æµ‹è¯•å¥—ä»¶                                              â”‚
â”‚ âœ“ ä»£ç è¦†ç›–ç‡ (â‰¥80%)                                         â”‚
â”‚ âœ“ æ•…äº‹éªŒè¯                                                  â”‚
â”‚ âœ“ åˆ†æ”¯ä¿æŠ¤                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ å‡†å¤‡åˆå¹¶     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## çºµæ·±é˜²å¾¡æ¶æ„

### å±‚çº§ 1ï¼šæäº¤å‰ (æœ¬åœ° - å¿«é€Ÿ)

**æ€§èƒ½ç›®æ ‡ï¼š** &lt;5 ç§’
**è§¦å‘å™¨ï¼š** `git commit`
**ä½ç½®ï¼š** `.husky/pre-commit`

**éªŒè¯å†…å®¹ï¼š**

- ESLint ä»£ç è´¨é‡
- TypeScript ç±»å‹æ£€æŸ¥
- è¯­æ³•é”™è¯¯
- å¯¼å…¥é—®é¢˜

**å·¥ä½œåŸç†ï¼š**

```bash
# åœ¨æäº¤æ—¶è‡ªåŠ¨è§¦å‘
git add .
git commit -m "feat: add feature"

# è¿è¡Œï¼š
# 1. ESLint with caching (.eslintcache)
# 2. TypeScript incremental compilation (.tsbuildinfo)
```

**å¥½å¤„ï¼š**

- âš¡ å¿«é€Ÿåé¦ˆ (&lt;5ç§’)
- ğŸ’¾ ç¼“å­˜ä»¥è·å¾—é€Ÿåº¦
- ğŸ”’ é˜²æ­¢æ–­è£‚ä»£ç æäº¤
- ğŸš« å†å²ä¸­æ²¡æœ‰æ— æ•ˆè¯­æ³•

### å±‚çº§ 2ï¼šæ¨é€å‰ (æœ¬åœ° - æ•…äº‹éªŒè¯)

**æ€§èƒ½ç›®æ ‡ï¼š** &lt;2 ç§’
**è§¦å‘å™¨ï¼š** `git push`
**ä½ç½®ï¼š** `.husky/pre-push`

**éªŒè¯å†…å®¹ï¼š**

- æ•…äº‹å¤é€‰æ¡†å®Œæˆåº¦ä¸çŠ¶æ€
- éœ€è¦çš„æ•…äº‹éƒ¨åˆ†å­˜åœ¨
- çŠ¶æ€ä¸€è‡´æ€§
- å¼€å‘ä»£ç†è®°å½•

**å·¥ä½œåŸç†ï¼š**

```bash
# åœ¨æ¨é€æ—¶è‡ªåŠ¨è§¦å‘
git push origin feature/my-feature

# éªŒè¯ docs/stories/ ä¸­çš„æ‰€æœ‰æ•…äº‹æ–‡ä»¶
```

**éªŒè¯è§„åˆ™ï¼š**

1. **çŠ¶æ€ä¸€è‡´æ€§ï¼š**

```yaml
# âŒ æ— æ•ˆï¼šå·²å®Œæˆä½†ä»»åŠ¡æœªå®Œæˆ
status: "completed"
tasks:
  - "[x] Task 1"
  - "[ ] Task 2"  # é”™è¯¯ï¼

# âœ… æœ‰æ•ˆï¼šæ‰€æœ‰ä»»åŠ¡å®Œæˆ
status: "completed"
tasks:
  - "[x] Task 1"
  - "[x] Task 2"
```

2. **å¿…éœ€éƒ¨åˆ†ï¼š**

- `id`
- `title`
- `description`
- `acceptance_criteria`
- `status`

3. **çŠ¶æ€æµï¼š**

```
ready â†’ in progress â†’ Ready for Review â†’ completed
```

### å±‚çº§ 3ï¼šCI/CD (äº‘ - æƒå¨)

**æ€§èƒ½ï¼š** 2-5 åˆ†é’Ÿ
**è§¦å‘å™¨ï¼š** æ¨é€ä»»ä½•åˆ†æ”¯ã€åˆ›å»º PR
**å¹³å°ï¼š** GitHub Actions
**ä½ç½®ï¼š** `.github/workflows/ci.yml`

**ä½œä¸šï¼š**

1. **ESLint** (`lint` ä½œä¸š)
   - åœ¨å¹²å‡€ç¯å¢ƒä¸­è¿è¡Œ
   - ä¸ä¾èµ–ç¼“å­˜

2. **TypeScript** (`typecheck` ä½œä¸š)
   - å®Œæ•´ç±»å‹æ£€æŸ¥
   - æ— å¢é‡ç¼–è¯‘

3. **æµ‹è¯•** (`test` ä½œä¸š)
   - å®Œæ•´æµ‹è¯•å¥—ä»¶
   - è¦†ç›–ç‡æŠ¥å‘Š
   - å¼ºåˆ¶æ‰§è¡Œ 80% é˜ˆå€¼

4. **æ•…äº‹éªŒè¯** (`story-validation` ä½œä¸š)
   - æ‰€æœ‰æ•…äº‹éªŒè¯
   - çŠ¶æ€ä¸€è‡´æ€§æ£€æŸ¥

5. **éªŒè¯æ‘˜è¦** (`validation-summary` ä½œä¸š)
   - æ±‡æ€»æ‰€æœ‰ç»“æœ
   - å¦‚æœä»»ä½•å¤±è´¥åˆ™é˜»æ­¢åˆå¹¶

**æ€§èƒ½ç›‘æ§ï¼š**

- å¯é€‰çš„æ€§èƒ½ä½œä¸š
- æµ‹é‡éªŒè¯æ—¶é—´
- ä»…ä¾›å‚è€ƒ

## å±‚çº§ 1ï¼šæäº¤å‰éªŒè¯

### å¿«é€Ÿå‚è€ƒ

```bash
# æ‰‹åŠ¨éªŒè¯
npm run lint
npm run typecheck

# è‡ªåŠ¨ä¿®å¤ lint é—®é¢˜
npm run lint -- --fix

# è·³è¿‡é’©å­ï¼ˆä¸æ¨èï¼‰
git commit --no-verify
```

### ESLint é…ç½®

**æ–‡ä»¶ï¼š** `.eslintrc.json`

```json
{
  "extends": ["eslint:recommended", "plugin:@typescript-eslint/recommended"],
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "cache": true,
  "cacheLocation": ".eslintcache"
}
```

**ä¸»è¦åŠŸèƒ½ï¼š**

- TypeScript æ”¯æŒ
- ç¼“å­˜å¯ç”¨
- è­¦å‘Š console.log
- ç”¨ `_` å‰ç¼€å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡

### TypeScript é…ç½®

**æ–‡ä»¶ï¼š** `tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "strict": true,
    "incremental": true,
    "tsBuildInfoFile": ".tsbuildinfo"
  }
}
```

**ä¸»è¦åŠŸèƒ½ï¼š**

- ES2022 ç›®æ ‡
- ä¸¥æ ¼æ¨¡å¼
- å¢é‡ç¼–è¯‘
- CommonJS æ¨¡å—

### æ€§èƒ½ä¼˜åŒ–

**ç¼“å­˜æ–‡ä»¶ï¼š**

- `.eslintcache` - ESLint ç»“æœ
- `.tsbuildinfo` - TypeScript å¢é‡æ•°æ®

**é¦–æ¬¡è¿è¡Œï¼š** ~10-15ç§’ï¼ˆæ— ç¼“å­˜ï¼‰
**åç»­è¿è¡Œï¼š** &lt;5ç§’ï¼ˆç¼“å­˜ï¼‰

**ç¼“å­˜å¤±æ•ˆï¼š**

- é…ç½®æ›´æ”¹
- ä¾èµ–æ›´æ–°
- æ–‡ä»¶åˆ é™¤

## å±‚çº§ 2ï¼šæ¨é€å‰éªŒè¯

### å¿«é€Ÿå‚è€ƒ

```bash
# æ‰‹åŠ¨éªŒè¯
node .aios-core/utils/aios-validator.js pre-push
node .aios-core/utils/aios-validator.js stories

# éªŒè¯å•ä¸ªæ•…äº‹
node .aios-core/utils/aios-validator.js story docs/stories/1.1-story.yaml

# è·³è¿‡é’©å­ï¼ˆä¸æ¨èï¼‰
git push --no-verify
```

### æ•…äº‹éªŒè¯å™¨

**ä½ç½®ï¼š** `.aios-core/utils/aios-validator.js`

**åŠŸèƒ½ï¼š**

- å½©è‰²ç»ˆç«¯è¾“å‡º
- è¿›åº¦æŒ‡ç¤ºå™¨
- æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
- æ½œåœ¨é—®é¢˜çš„è­¦å‘Š

**ç¤ºä¾‹è¾“å‡ºï¼š**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  æ•…äº‹éªŒè¯: 2.2-git-workflow-implementation.yaml
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ•…äº‹: 2.2 - å¸¦æœ‰å¤šå±‚éªŒè¯çš„ Git å·¥ä½œæµ
çŠ¶æ€: in progress

è¿›åº¦: 12/15 ä»»åŠ¡ (80.0%)

âœ“ æ•…äº‹éªŒè¯é€šè¿‡ï¼Œæœ‰è­¦å‘Š

è­¦å‘Šï¼š
  â€¢ è€ƒè™‘å°†çŠ¶æ€æ›´æ–°ä¸º 'Ready for Review'
```

### éªŒè¯è§„åˆ™

#### 1. å¤é€‰æ¡†æ ¼å¼

æ”¯æŒçš„æ ¼å¼ï¼š

- `[x]` - å®Œæˆï¼ˆå°å†™ï¼‰
- `[X]` - å®Œæˆï¼ˆå¤§å†™ï¼‰
- `[ ]` - æœªå®Œæˆ

æ— æ³•è¯†åˆ«çš„ï¼š

- `[o]`, `[*]`, `[-]` - ä¸è®¡ä¸ºå®Œæˆ

#### 2. çŠ¶æ€ä¸€è‡´æ€§

| çŠ¶æ€ | è§„åˆ™ |
|------|------|
| `ready` | ä¸åº”æ£€æŸ¥ä»»ä½•ä»»åŠ¡ |
| `in progress` | æ£€æŸ¥æŸäº›ä»»åŠ¡ |
| `Ready for Review` | æ‰€æœ‰ä»»åŠ¡éƒ½å·²æ£€æŸ¥ |
| `completed` | æ‰€æœ‰ä»»åŠ¡éƒ½å·²æ£€æŸ¥ |

#### 3. å¿…éœ€éƒ¨åˆ†

æ‰€æœ‰æ•…äº‹å¿…é¡»å…·æœ‰ï¼š

```yaml
id: "X.X"
title: "æ•…äº‹æ ‡é¢˜"
description: "æ•…äº‹æè¿°"
status: "ready" | "in progress" | "Ready for Review" | "completed"
acceptance_criteria:
  - name: "æ ‡å‡†"
    tasks:
      - "[ ] ä»»åŠ¡"
```

#### 4. å¼€å‘ä»£ç†è®°å½•

æ¨èä½†éå¿…éœ€ï¼š

```yaml
dev_agent_record:
  agent_model: 'claude-sonnet-4-5'
  implementation_date: '2025-01-23'
```

ç¼ºå°‘æ—¶å‡ºç°è­¦å‘Šã€‚

### é”™è¯¯æ¶ˆæ¯

**ç¼ºå°‘å¿…éœ€çš„éƒ¨åˆ†ï¼š**

```
âœ— ç¼ºå°‘å¿…éœ€çš„éƒ¨åˆ†: description, acceptance_criteria
```

**çŠ¶æ€ä¸ä¸€è‡´ï¼š**

```
âœ— æ•…äº‹æ ‡è®°ä¸ºå·²å®Œæˆï¼Œä½†ä»… 12/15 ä¸ªä»»åŠ¡å·²æ£€æŸ¥
```

**ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼š**

```
âœ— æ‰¾ä¸åˆ°æ•…äº‹æ–‡ä»¶: docs/stories/missing.yaml
```

## å±‚çº§ 3ï¼šCI/CD æµç¨‹

### å·¥ä½œæµç»“æ„

**æ–‡ä»¶ï¼š** `.github/workflows/ci.yml`

**ä½œä¸šï¼š**

1. **lint** - ESLint éªŒè¯
2. **typecheck** - TypeScript æ£€æŸ¥
3. **test** - Jest æµ‹è¯•å’Œè¦†ç›–ç‡
4. **story-validation** - æ•…äº‹ä¸€è‡´æ€§
5. **validation-summary** - æ±‡æ€»ç»“æœ
6. **performance** (å¯é€‰) - æ€§èƒ½æŒ‡æ ‡

### ä½œä¸šè¯¦æƒ…

#### ESLint ä½œä¸š

```yaml
- name: Run ESLint
  run: npm run lint
```

- åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
- è¶…æ—¶ï¼š5 åˆ†é’Ÿ
- ä½¿ç”¨ npm ç¼“å­˜
- ä»»ä½• lint é”™è¯¯éƒ½ä¼šå¤±è´¥

#### TypeScript ä½œä¸š

```yaml
- name: Run TypeScript type checking
  run: npm run typecheck
```

- åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
- è¶…æ—¶ï¼š5 åˆ†é’Ÿ
- ç±»å‹é”™è¯¯æ—¶å¤±è´¥

#### æµ‹è¯•ä½œä¸š

```yaml
- name: Run tests with coverage
  run: npm run test:coverage
```

- åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
- è¶…æ—¶ï¼š10 åˆ†é’Ÿ
- å°†è¦†ç›–ç‡ä¸Šä¼ åˆ° Codecov
- å¼ºåˆ¶æ‰§è¡Œ 80% è¦†ç›–ç‡é˜ˆå€¼

#### æ•…äº‹éªŒè¯ä½œä¸š

```yaml
- name: Validate story checkboxes
  run: node .aios-core/utils/aios-validator.js stories
```

- åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
- è¶…æ—¶ï¼š5 åˆ†é’Ÿ
- éªŒè¯æ‰€æœ‰æ•…äº‹

#### éªŒè¯æ‘˜è¦ä½œä¸š

```yaml
needs: [lint, typecheck, test, story-validation]
if: always()
```

- æ‰€æœ‰éªŒè¯åè¿è¡Œ
- æ£€æŸ¥æ‰€æœ‰ä½œä¸šçŠ¶æ€
- å¦‚æœä»»ä½•éªŒè¯å¤±è´¥åˆ™å¤±è´¥
- æä¾›æ‘˜è¦

### CI è§¦å‘å™¨

**æ¨é€äº‹ä»¶ï¼š**

- `master` åˆ†æ”¯
- `develop` åˆ†æ”¯
- `feature/**` åˆ†æ”¯
- `bugfix/**` åˆ†æ”¯

**æ‹‰å–è¯·æ±‚äº‹ä»¶ï¼š**

- å¯¹ `master`
- å¯¹ `develop`

### æŸ¥çœ‹ CI ç»“æœ

```bash
# æŸ¥çœ‹ PR æ£€æŸ¥
gh pr checks

# æŸ¥çœ‹å·¥ä½œæµè¿è¡Œ
gh run list

# æŸ¥çœ‹ç‰¹å®šè¿è¡Œ
gh run view <run-id>

# é‡æ–°è¿è¡Œå¤±è´¥çš„ä½œä¸š
gh run rerun <run-id>
```

## åˆ†æ”¯ä¿æŠ¤

### è®¾ç½®

```bash
# è¿è¡Œè®¾ç½®è„šæœ¬
node scripts/setup-branch-protection.js

# æŸ¥çœ‹å½“å‰ä¿æŠ¤
node scripts/setup-branch-protection.js --status
```

### éœ€æ±‚

- å·²å®‰è£… GitHub CLI (`gh`)
- ä½¿ç”¨ GitHub è¿›è¡Œèº«ä»½éªŒè¯
- å¯¹å­˜å‚¨åº“å…·æœ‰ç®¡ç†å‘˜è®¿é—®æƒé™

### ä¿æŠ¤è§„åˆ™

**ä¸»åˆ†æ”¯ä¿æŠ¤ï¼š**

1. **å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥ï¼š**
   - ESLint
   - TypeScript ç±»å‹æ£€æŸ¥
   - Jest æµ‹è¯•
   - æ•…äº‹å¤é€‰æ¡†éªŒè¯

2. **æ‹‰å–è¯·æ±‚å®¡æŸ¥ï¼š**
   - éœ€è¦ 1 æ¬¡æ‰¹å‡†
   - å…³é—­æ–°æäº¤ä¸­çš„é™ˆæ—§å®¡æŸ¥

3. **å…¶ä»–è§„åˆ™ï¼š**
   - çº¿æ€§å†å²å¼ºåˆ¶æ‰§è¡Œï¼ˆä»… rebaseï¼‰
   - å¼ºåˆ¶æ¨é€è¢«é˜»æ­¢
   - åˆ†æ”¯åˆ é™¤è¢«é˜»æ­¢
   - è§„åˆ™é€‚ç”¨äºç®¡ç†å‘˜

### æ‰‹åŠ¨é…ç½®

é€šè¿‡ GitHub CLIï¼š

```bash
# è®¾ç½®å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥
gh api repos/OWNER/REPO/branches/master/protection/required_status_checks \
  -X PUT \
  -f strict=true \
  -f contexts[]="ESLint" \
  -f contexts[]="TypeScript Type Checking"

# éœ€è¦ PR å®¡æŸ¥
gh api repos/OWNER/REPO/branches/master/protection/required_pull_request_reviews \
  -X PUT \
  -f required_approving_review_count=1

# é˜»æ­¢å¼ºåˆ¶æ¨é€
gh api repos/OWNER/REPO/branches/master/protection/allow_force_pushes \
  -X DELETE
```

## æ—¥å¸¸å·¥ä½œæµ

### å¼€å§‹æ–°åŠŸèƒ½

```bash
# 1. æ›´æ–° master
git checkout master
git pull origin master

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/my-feature

# 3. è¿›è¡Œæ›´æ”¹
# ... ç¼–è¾‘æ–‡ä»¶ ...

# 4. æäº¤ï¼ˆè§¦å‘æäº¤å‰é’©å­ï¼‰
git add .
git commit -m "feat: add my feature [Story X.X]"

# 5. æ¨é€ï¼ˆè§¦å‘æ¨é€å‰é’©å­ï¼‰
git push origin feature/my-feature

# 6. åˆ›å»º PR
gh pr create --title "feat: Add my feature" --body "Description"
```

### æ›´æ–°æ•…äº‹

```bash
# 1. æ‰“å¼€æ•…äº‹æ–‡ä»¶
code docs/stories/X.X-story.yaml

# 2. æ ‡è®°ä»»åŠ¡å®Œæˆ
# æ›´æ”¹: - "[ ] Task"
# ä¸º:   - "[x] Task"

# 3. å¦‚æœéœ€è¦æ›´æ–°çŠ¶æ€
# æ›´æ”¹: status: "in progress"
# ä¸º:   status: "Ready for Review"

# 4. æäº¤æ•…äº‹æ›´æ–°
git add docs/stories/X.X-story.yaml
git commit -m "docs: update story X.X progress"

# 5. æ¨é€ï¼ˆéªŒè¯æ•…äº‹ï¼‰
git push
```

### ä¿®å¤éªŒè¯å¤±è´¥

**ESLint é”™è¯¯ï¼š**

```bash
# è‡ªåŠ¨ä¿®å¤é—®é¢˜
npm run lint -- --fix

# æ£€æŸ¥å‰©ä½™é—®é¢˜
npm run lint

# æäº¤ä¿®å¤
git add .
git commit -m "style: fix lint issues"
```

**TypeScript é”™è¯¯ï¼š**

```bash
# æŸ¥çœ‹æ‰€æœ‰é”™è¯¯
npm run typecheck

# åœ¨ä»£ç ä¸­ä¿®å¤é”™è¯¯
# ... ç¼–è¾‘æ–‡ä»¶ ...

# éªŒè¯ä¿®å¤
npm run typecheck

# æäº¤ä¿®å¤
git add .
git commit -m "fix: resolve type errors"
```

**æ•…äº‹éªŒè¯é”™è¯¯ï¼š**

```bash
# æ£€æŸ¥æ•…äº‹
node .aios-core/utils/aios-validator.js stories

# ä¿®å¤æ•…äº‹æ–‡ä»¶
code docs/stories/X.X-story.yaml

# éªŒè¯ä¿®å¤
node .aios-core/utils/aios-validator.js story docs/stories/X.X-story.yaml

# æäº¤ä¿®å¤
git add docs/stories/
git commit -m "docs: fix story validation"
```

**æµ‹è¯•å¤±è´¥ï¼š**

```bash
# è¿è¡Œæµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- path/to/test.js

# ä¿®å¤å¤±è´¥çš„æµ‹è¯•
# ... ç¼–è¾‘æµ‹è¯•æ–‡ä»¶ ...

# è¿è¡Œè¦†ç›–ç‡
npm run test:coverage

# æäº¤ä¿®å¤
git add .
git commit -m "test: fix failing tests"
```

### åˆå¹¶æ‹‰å–è¯·æ±‚

```bash
# 1. ç¡®ä¿ CI é€šè¿‡
gh pr checks

# 2. è·å¾—æ‰¹å‡†
# ï¼ˆç­‰å¾…å›¢é˜Ÿæˆå‘˜å®¡æŸ¥ï¼‰

# 3. åˆå¹¶ï¼ˆsquashï¼‰
gh pr merge --squash --delete-branch

# 4. æ›´æ–°æœ¬åœ° master
git checkout master
git pull origin master
```

## æ•…éšœæ’é™¤

### é’©å­æœªè¿è¡Œ

**ç—‡çŠ¶ï¼š** æäº¤æˆåŠŸä½†æœªè¿›è¡ŒéªŒè¯

**è§£å†³æ–¹æ¡ˆï¼š**

1. æ£€æŸ¥ Husky å®‰è£…ï¼š

```bash
npm run prepare
```

2. éªŒè¯é’©å­æ–‡ä»¶å­˜åœ¨ï¼š

```bash
ls -la .husky/pre-commit
ls -la .husky/pre-push
```

3. æ£€æŸ¥æ–‡ä»¶æƒé™ (Unix)ï¼š

```bash
chmod +x .husky/pre-commit
chmod +x .husky/pre-push
```

### æäº¤å‰é’©å­é€Ÿåº¦ç¼“æ…¢

**ç—‡çŠ¶ï¼š** æäº¤å‰é’©å­èŠ±è´¹ >10 ç§’

**è§£å†³æ–¹æ¡ˆï¼š**

1. æ¸…é™¤ç¼“å­˜ï¼š

```bash
rm .eslintcache .tsbuildinfo
git commit  # é‡å»ºç¼“å­˜
```

2. æ£€æŸ¥æ–‡ä»¶æ›´æ”¹ï¼š

```bash
git status
# ä¸€æ¬¡æäº¤è¾ƒå°‘çš„æ–‡ä»¶
```

3. æ›´æ–°ä¾èµ–ï¼š

```bash
npm update
```

### æ•…äº‹éªŒè¯å¤±è´¥

**ç—‡çŠ¶ï¼š** æ¨é€å‰å¤±è´¥ï¼Œæ˜¾ç¤ºæ•…äº‹é”™è¯¯

**å¸¸è§é—®é¢˜ï¼š**

1. **å¤é€‰æ¡†ä¸åŒ¹é…ï¼š**

```yaml
# é”™è¯¯ï¼šå®ŒæˆçŠ¶æ€ä½†ä»»åŠ¡æœªå®Œæˆ
status: 'completed'
tasks:
  - '[x] Task 1'
  - '[ ] Task 2' # â† ä¿®å¤æ­¤é¡¹

# è§£å†³æ–¹æ¡ˆï¼šå®Œæˆæ‰€æœ‰ä»»åŠ¡æˆ–æ›´æ”¹çŠ¶æ€
```

2. **ç¼ºå°‘éƒ¨åˆ†ï¼š**

```yaml
# é”™è¯¯ï¼šç¼ºå°‘å¿…éœ€çš„éƒ¨åˆ†
id: '1.1'
title: 'Story'
# ç¼ºå°‘: description, acceptance_criteria, status

# è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ ç¼ºå°‘çš„éƒ¨åˆ†
```

3. **æ— æ•ˆçš„ YAMLï¼š**

```yaml
# é”™è¯¯ï¼šæ— æ•ˆçš„ YAML è¯­æ³•
tasks:
  - "[ ] Task 1
  - "[ ] Task 2"  # â† ä¸Šé¢ç¼ºå°‘ç»“æŸå¼•å·

# è§£å†³æ–¹æ¡ˆï¼šä¿®å¤ YAML è¯­æ³•
```

### CI å¤±è´¥ä½†æœ¬åœ°é€šè¿‡

**ç—‡çŠ¶ï¼š** CI å¤±è´¥ä½†æ‰€æœ‰æœ¬åœ°éªŒè¯é€šè¿‡

**å¸¸è§åŸå› ï¼š**

1. **ç¼“å­˜å·®å¼‚ï¼š**

```bash
# æ¸…é™¤æœ¬åœ°ç¼“å­˜
rm -rf node_modules .eslintcache .tsbuildinfo coverage/
npm ci
npm test
```

2. **ç¯å¢ƒå·®å¼‚ï¼š**

```bash
# ä½¿ç”¨ä¸ CI ç›¸åŒçš„ Node ç‰ˆæœ¬ (18)
nvm use 18
npm test
```

3. **æœªæäº¤çš„æ–‡ä»¶ï¼š**

```bash
# æ£€æŸ¥æœªæäº¤çš„æ›´æ”¹
git status

# å¦‚æœéœ€è¦éšè—
git stash
```

### åˆ†æ”¯ä¿æŠ¤é˜»æ­¢åˆå¹¶

**ç—‡çŠ¶ï¼š** æ— æ³•åˆå¹¶ PRï¼Œå³ä½¿æœ‰æ‰¹å‡†

**æ£€æŸ¥ï¼š**

1. **éœ€è¦çš„æ£€æŸ¥é€šè¿‡ï¼š**

```bash
gh pr checks
# æ‰€æœ‰å¿…é¡»æ˜¾ç¤º âœ“
```

2. **éœ€è¦çš„æ‰¹å‡†ï¼š**

```bash
gh pr view
# æ£€æŸ¥"å®¡æŸ¥è€…"éƒ¨åˆ†
```

3. **åˆ†æ”¯æ˜¯æœ€æ–°çš„ï¼š**

```bash
# æ›´æ–°åˆ†æ”¯
git checkout feature-branch
git rebase master
git push --force-with-lease
```

## æ€§èƒ½æç¤º

### ç¼“å­˜ç®¡ç†

**ä¿ç•™ç¼“å­˜ï¼š**

- `.eslintcache` - ESLint ç»“æœ
- `.tsbuildinfo` - TypeScript æ„å»ºä¿¡æ¯
- `coverage/` - æµ‹è¯•è¦†ç›–ç‡æ•°æ®

**æäº¤åˆ° .gitignoreï¼š**

```gitignore
.eslintcache
.tsbuildinfo
coverage/
```

### å¢é‡å¼€å‘

**æœ€ä½³å®è·µï¼š**

1. **å°æäº¤ï¼š**
   - æ›´å°‘çš„æ–‡ä»¶ = æ›´å¿«çš„éªŒè¯
   - æ›´å®¹æ˜“è°ƒè¯•å¤±è´¥

2. **åœ¨å¼€å‘æœŸé—´è¿›è¡Œæµ‹è¯•ï¼š**

```bash
# åœ¨æäº¤å‰æ‰‹åŠ¨è¿è¡ŒéªŒè¯
npm run lint
npm run typecheck
npm test
```

3. **ç«‹å³ä¿®å¤é—®é¢˜ï¼š**
   - ä¸è¦è®©é—®é¢˜å †ç§¯
   - åœ¨ä¸Šä¸‹æ–‡ä¸­æ›´å®¹æ˜“ä¿®å¤

### CI ä¼˜åŒ–

**å·¥ä½œæµä¼˜åŒ–ï¼š**

1. **å¹¶è¡Œä½œä¸š** - æ‰€æœ‰éªŒè¯å¹¶è¡Œè¿è¡Œ
2. **ä½œä¸šè¶…æ—¶** - åœ¨æŒ‚èµ·æ—¶å¿«é€Ÿå¤±è´¥
3. **ç¼“å­˜** - npm ä¾èµ–è¢«ç¼“å­˜
4. **æ¡ä»¶ä½œä¸š** - æ€§èƒ½ä½œä¸šä»…åœ¨ PR ä¸Š

### æ•…äº‹éªŒè¯æ€§èƒ½

**å½“å‰æ€§èƒ½ï¼š**

- å•ä¸ªæ•…äº‹ï¼š&lt;100ms
- æ‰€æœ‰æ•…äº‹ï¼š&lt;2ç§’ï¼ˆå…¸å‹ï¼‰

**ä¼˜åŒ–æç¤ºï¼š**

1. **ä¿æŒæ•…äº‹ä¸“æ³¨** - æ¯ä¸ªæ•…äº‹ä¸€ä¸ªåŠŸèƒ½
2. **é™åˆ¶ä»»åŠ¡æ•°** - å°†å¤§æ•…äº‹åˆ†è§£ä¸ºè¾ƒå°çš„æ•…äº‹
3. **æœ‰æ•ˆçš„ YAML** - è§£æé”™è¯¯ä¼šå‡æ…¢éªŒè¯

## é«˜çº§ä¸»é¢˜

### è·³è¿‡éªŒè¯

**é€‚å½“æ—¶æœºï¼š**

- ç´§æ€¥ä¿®å¤
- ä»…æ–‡æ¡£æ›´æ”¹
- CI é…ç½®æ›´æ”¹

**å¦‚ä½•è·³è¿‡ï¼š**

```bash
# è·³è¿‡æäº¤å‰
git commit --no-verify

# è·³è¿‡æ¨é€å‰
git push --no-verify

# è·³è¿‡ CIï¼ˆä¸æ¨èï¼‰
# å°† [skip ci] æ·»åŠ åˆ°æäº¤æ¶ˆæ¯
git commit -m "docs: update [skip ci]"
```

**è­¦å‘Šï¼š** ä»…åœ¨ç»å¯¹å¿…è¦æ—¶è·³è¿‡ã€‚è·³è¿‡çš„éªŒè¯ä¸ä¼šå‘ç°é—®é¢˜ã€‚

### è‡ªå®šä¹‰éªŒè¯

**æ·»åŠ è‡ªå®šä¹‰éªŒè¯å™¨ï¼š**

1. **åˆ›å»ºéªŒè¯å™¨å‡½æ•°ï¼š**

```javascript
// .aios-core/utils/custom-validator.js
module.exports = async function validateCustom() {
  // æ‚¨çš„éªŒè¯é€»è¾‘
  return { success: true, errors: [] };
};
```

2. **æ·»åŠ åˆ°é’©å­ï¼š**

```bash
# .husky/pre-commit
node .aios-core/utils/aios-validator.js pre-commit
node .aios-core/utils/custom-validator.js
```

3. **æ·»åŠ åˆ° CIï¼š**

```yaml
# .github/workflows/ci.yml
- name: Custom validation
  run: node .aios-core/utils/custom-validator.js
```

### Monorepo æ”¯æŒ

**å¯¹äº monoreposï¼š**

1. **é™åˆ¶éªŒè¯èŒƒå›´ï¼š**

```javascript
// ä»…éªŒè¯æ›´æ”¹çš„åŒ…
const changedFiles = execSync('git diff --name-only HEAD~1').toString();
const packages = getAffectedPackages(changedFiles);
```

2. **å¹¶è¡ŒåŒ…éªŒè¯ï¼š**

```yaml
strategy:
  matrix:
    package: [package-a, package-b, package-c]
```

## å‚è€ƒ

- **AIOS éªŒè¯å™¨ï¼š** [.aios-core/utils/aios-validator.js](../.aios-core/utils/aios-validator.js)
- **CI å·¥ä½œæµï¼š** [.github/workflows/ci.yml](../.github/workflows/ci.yml)

---

**æœ‰ç–‘é—®ï¼Ÿæœ‰é—®é¢˜å—ï¼Ÿ**

- [æ‰“å¼€é—®é¢˜](https://github.com/SynkraAI/aios-core/issues)
- [åŠ å…¥ Discord](https://discord.gg/gk8jAdXWmj)
